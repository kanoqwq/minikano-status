<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minikano „ÅÆ Áä∂ÊÄÅ</title>
    <style>
        body {
            position: relative;
            margin: 0;
            padding: 0;
            background-image: url('https://api.kanokano.cn/startThere/assets/bg.webp');
            background-attachment: fixed;
            background-size: cover;
        }

        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 40px;
            padding-bottom: 10px;
        }

        .box {
            overflow: auto;
            width: 100%;
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            box-shadow: #0000004b 0px 0px 10px 0px;
            margin: 0 20px;
        }

        .deviceList {
            overflow: hidden;
            color: #fff;
        }

        .deviceList li {
            border-radius: 10px;
            background-color: #ffffff70;
            /* backdrop-filter: blur(10px); */
            padding: 4px;
            margin-bottom: 10px;
        }

        .deviceList li p {
            display: flex;
            flex-wrap: wrap;
            overflow: auto;
            margin: 0;
            padding: 10px 0;
            padding-bottom: 5px;
            border-radius: 10px;
        }

        .deviceList strong {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            padding: 10px;
            background-color: rgba(255, 86, 2, 0.337);
            border-radius: 10px;
        }

        .deviceList strong {
            width: fit-content;
            box-sizing: border-box;
            margin: 5px;
            margin-top: 0;
            border: 1px solid transparent;
            transition: all 0.3s;
        }

        .deviceList strong:hover,
        .deviceList strong:active {
            border: 1px solid pink;
            box-shadow: 0 0 10px pink;
            transform: scale(1.01);
        }

        .green {
            color: rgba(40, 209, 40, 0.6);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.918);
        }

        .red {
            color: rgba(202, 41, 41, 0.6);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.918);
        }

        .blue {
            color: rgb(5, 200, 254);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.918);
        }

        .title {
            margin-top: 0;
            padding-left: 10px;
            border-left: 6px solid skyblue;
        }

        .footer {
            margin: 0 auto;
            margin-bottom: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border-radius: 10px;
            background-color: #ffffff79;
            max-width: fit-content;
        }

        .footer p {
            margin: 0;
            padding: 5px 15px;
        }

        .modal {
            position: fixed;
            overflow: hidden;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff82;
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            opacity: 1;
            transition: all .3s;
            /* background-color: #00ffdd17; */
            box-shadow: 0 0 10px 0 #00ffdd96;
        }

        .modal button {
            padding: 5px 10px;
            background-color: skyblue;
            border: 1px solid transparent;
            border-radius: 5px;
            color: white;
            transition: box-shadow .2s;
        }

        .modal button:hover {
            box-shadow: 0 0 10px 0 skyblue
        }

        .modal button:active {
            border: 1px solid pink;
        }

        .modal input {
            border-radius: 6px;
            border: 1px solid skyblue;
        }

        .modal .content {
            overflow: auto;
            overflow-x: hidden;
            max-height: 300px;
        }

        .modal .action {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #00ffdd7c;
            padding: 5px 6px;
            border-radius: 6px;
        }

        .modal .action input {
            height: 30px;
            padding: 5px;
            box-sizing: border-box;
        }

        .sms-item {
            position: relative;
            max-width: 500px;
            padding: 10px;
            margin: 10px;
            border-radius: 10px;
            background: #ffffff70;
            font-size: 14px;
        }

        .arrow {
            content: '';
            position: absolute;
            display: block;
            z-index: 111;
            top: 0;
            width: 0;
            height: 0;
            border: 15px solid;
            margin: 10px 0;
        }

        .sms-item p {
            margin: 0;
            overflow: hidden;
            word-wrap: break-word;
        }

        ::-webkit-scrollbar {
            width: 1px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="box" id="kano_box">
            <h2 class="title">MiniKano „ÅÆ Êë∏È±ºÁä∂ÊÄÅÔºü üïõ</h2>
            <strong><i>Êë∏È±ºÊâçÊòØÁ¨¨‰∏ÄÁîü‰∫ßÂäõÔºÅ</i></strong>
            <p>ËÆæÂ§áÂàóË°®Ôºö</p>
            <ul id="deviceList" class="deviceList">
                <h2 style="color: #333;margin:0">Loading...</h2>
            </ul>
        </div>
    </div>
    <div class="footer">
        <p>This page is created by <a href="https://github.com/kanoqwq">MiniKano</a> with love ‚ù§Ô∏è</p>
    </div>
    <div class="modal" id="tokenModal" style="display: none;">
        <div class="title">ÊèêÁ§∫</div>
        <div class="content">
            <p>ËØ∑ËæìÂÖ•ËØ∑Ê±ÇtokenÔºö</p>
            <input id="tokenInput" type="text" style="margin-bottom: 20px;">
        </div>
        <div class="btn" style="text-align: right;">
            <button onclick="onTokenConfirm()">Á°ÆËÆ§</button>
            <button onclick="closeModal('#tokenModal')">ÂèñÊ∂à</button>
        </div>
    </div>
    <div class="modal" id="smsList" style="display: none;">
        <div class="title" style="margin-bottom: 6px;">Áü≠‰ø°ÂàóË°®</div>
        <div class="action" style="margin-top: 10px;background-color: #00ffdd17;box-shadow: 0 0 10px 0 #00ffdd96;">
            <span>Êî∂‰ª∂‰∫∫Ôºö</span>
            <input id="PhoneInput" type="number" style="flex: 1;margin-right: 6px"></input>
        </div>
        <div class="content" id="content">
            <ul id="sms-list">
            </ul>
        </div>
        <div class="action" style="background-color: #00ffdd17;box-shadow: 0 0 10px 0 #00ffdd96;">
            <input id="SMSInput" type="text" style="flex: 1;margin-right: 6px"></input>
            <div class="btn">
                <button onclick="sendSMS()">ÂèëÈÄÅ</button>
                <button onclick="closeModal('#smsList')">ÂÖ≥Èó≠</button>
            </div>
        </div>

    </div>
    <script>
        function decodeBase64(base64String) {
            // Â∞ÜBase64Â≠óÁ¨¶‰∏≤ÂàÜÊàêÊØè64‰∏™Â≠óÁ¨¶‰∏ÄÁªÑ
            const padding = base64String.length % 4 === 0 ? 0 : 4 - (base64String.length % 4)
            base64String += '='.repeat(padding)

            // ‰ΩøÁî®atob()ÂáΩÊï∞Ëß£Á†ÅBase64Â≠óÁ¨¶‰∏≤
            const binaryString = window.atob(base64String)

            // Â∞Ü‰∫åËøõÂà∂Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫TypedArray
            const bytes = new Uint8Array(binaryString.length)
            for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i)

            // Â∞ÜTypedArrayËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤
            return new TextDecoder('utf-8').decode(bytes)
        }

        function createToast(text, color, delay = 3000) {
            const toastEl = document.createElement('div')
            toastEl.style.position = 'fixed'
            toastEl.style.padding = '10px'
            toastEl.style.top = '20px'
            toastEl.style.right = '50%'
            toastEl.style.transform = 'translateX(50%)'
            toastEl.style.color = color || 'while'
            toastEl.style.backgroundColor = '#ffffff54'
            toastEl.style.transition = `opacity .2s`
            toastEl.style.opacity = `0`
            toastEl.style.boxShadow = '0 0 10px 0 #00ffdd96'
            toastEl.style.fontWeight = 'bold'
            toastEl.style.backdropFilter = 'blur(10px)'
            toastEl.style.borderRadius = '6px'
            toastEl.innerHTML = text;
            const id = 'toastkano'
            toastEl.setAttribute('class', id);
            const toasts = document.querySelectorAll('.toastkano')
            document.body.appendChild(toastEl)
            setTimeout(() => {
                toastEl.style.opacity = `1`
            }, 0);
            if (toasts.length) {
                const top = toasts[toasts.length - 1].getBoundingClientRect().top
                const height = toastEl.getBoundingClientRect().height
                toastEl.style.top = top + height + 10 + 'px'
            }
            let timer = null
            setTimeout(() => {
                toastEl.style.opacity = `0`
                clearTimeout(timer)
                timer = setTimeout(() => {
                    document.body.removeChild(toastEl)
                }, 200);
            }, delay);
        }
        function closeModal(txt, time = 300) {
            let el = document.querySelector(txt)
            if (!el) return
            el.style.opacity = 0
            setTimeout(() => {
                el.style.display = 'none'
            }, time)
        }
        function showModal(txt, time = 300) {
            let el = document.querySelector(txt)
            if (!el) return
            el.style.opacity = 0
            el.style.display = 'block'
            setTimeout(() => {
                el.style.opacity = 1
            }, 10)
        }
        function onTokenConfirm() {
            let tkInput = document.querySelector('#tokenInput')
            let token = tkInput && (tkInput.value)
            if (!token || !token?.trim()) return createToast('Ê≤°Êúâtoken', 'red')
            localStorage.setItem('kano_sms_token', token.trim())
            closeModal('#tokenModal')
        }
        function kano_getSignalEmoji(strength) {
            const signals = ["üì∂ ‚¨ú‚¨ú‚¨ú‚¨ú", "üì∂ üü®‚¨ú‚¨ú‚¨ú", "üì∂ üü©üü®‚¨ú‚¨ú", "üì∂ üü©üü©üü®‚¨ú", "üì∂ üü©üü©üü©üü®", "üì∂ üü©üü©üü©üü©"];
            return signals[Math.max(0, Math.min(strength, 5))]; // Á°Æ‰øùËæìÂÖ•Âú® 0-5 ‰πãÈó¥
        }
        function kano_formatTime(seconds) {
            if (seconds < 60) {
                return `${seconds} Áßí`;
            } else if (seconds < 3600) {
                return `${(seconds / 60).toFixed(1)} ÂàÜÈíü`;
            } else {
                return `${(seconds / 3600).toFixed(1)} Â∞èÊó∂`;
            }
        }
        function requestInterval(callback, interval) {
            let lastTime = 0;
            let timeoutId = null;

            function loop(timestamp) {
                if (!lastTime) lastTime = timestamp; // ÂàùÂßãÂåñ‰∏äÊ¨°Êó∂Èó¥
                const delta = timestamp - lastTime; // ËÆ°ÁÆóÊó∂Èó¥Â∑Æ

                if (delta >= interval) {
                    callback(); // ÊâßË°å‰ªªÂä°
                    lastTime = timestamp; // Êõ¥Êñ∞‰∏äÊ¨°Êó∂Èó¥
                }

                timeoutId = requestAnimationFrame(loop); // ÁªßÁª≠ËØ∑Ê±Ç‰∏ã‰∏ÄÂ∏ß
            }

            timeoutId = requestAnimationFrame(loop); // ÂêØÂä®Âä®ÁîªÂæ™ÁéØ

            // ËøîÂõûÊ∏ÖÈô§ÂáΩÊï∞
            return () => cancelAnimationFrame(timeoutId);
        }
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Byte';

            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
        }
        var getSms = async () => {
            const TOKEN = localStorage.getItem('kano_sms_token')
            if (!TOKEN) {
                localStorage.removeItem('kano_sms_token')
                showModal('#tokenModal')
                return null
            }

            try {
                let res = await fetch('https://api.kanokano.cn/sms/', {
                    headers: {
                        token: TOKEN
                    }
                })
                let res_data = await res.json()

                if (res_data && res_data.status !== 0) {
                    localStorage.removeItem('kano_sms_token')
                    showModal('#tokenModal')
                    createToast(res_data.error, 'red')
                    return null
                }
                return res_data
            } catch {
                localStorage.removeItem('kano_sms_token')
                showModal('#tokenModal')
                return null
            }
        }
        let isDisabledSendSMS = false
        var sendSMS = async () => {
            const SMSInput = document.querySelector('#SMSInput')
            const PhoneInput = document.querySelector('#PhoneInput')
            if (SMSInput && SMSInput.value && SMSInput.value.trim()
                && PhoneInput && PhoneInput.value && Number(PhoneInput.value.trim())
            ) {
                const content = SMSInput.value.trim()
                const number = PhoneInput.value.trim()
                isDisabledSendSMS = true
                const res = await fetch('https://api.kanokano.cn/sms/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        token: localStorage.getItem('kano_sms_token')
                    },
                    body: JSON.stringify({
                        content, number
                    })
                })
                const res_data = await res.json()
                if (res_data && res_data.status == 0) {
                    SMSInput.value = ''
                    createToast('ÂèëÈÄÅÊàêÂäüÔºÅ', 'green')
                    handleSmsRender()
                } else {
                    createToast((res_data && res_data.message) ? res_data.message : 'ÂèëÈÄÅÂ§±Ë¥•', 'red')
                }
                isDisabledSendSMS = false
            } else {
                createToast('ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑ÂíåÂÜÖÂÆπ', 'red')
            }
        }
        let handleSmsRender = async () => {
            let list = document.querySelector('#sms-list')
            if (!list) createToast('Ê≤°ÊúâÊâæÂà∞Áü≠‰ø°ÂàóË°®ËäÇÁÇπ', 'red')
            list.innerHTML = ` <li><h2 style="padding: 30px;text-align:center">Loading...</h2></li>`
            showModal('#smsList')
            let res = await getSms()
            if (res && res.records) {
                const dateStrArr = ['Âπ¥', 'Êúà', 'Êó•', ':', ':', '']
                list.innerHTML = res.records.map(item => {
                    let date = item.date.split(',')
                    date.pop()
                    date = date.map((item, index) => {
                        return item + dateStrArr[index]
                    }).join('')
                    return `<li class="sms-item" style="${item.tag != '2' ? 'background-color:#00800063;margin-left:15px' : 'background-color:#ffc0cb82;margin-right:15px'}">
                                            <div class="arrow" style="${item.tag == '2' ? 'right:-30px;border-color: transparent transparent transparent #ffc0cb82' : 'left:-30px;border-color: transparent #00800063 transparent transparent'}"></div>
                                            <p style="color:purple;font-size:16px;margin:4px 0">${item.number}</p>
                                            <p>${decodeBase64(item.content)}</p>
                                            <p style="text-align:right;color:purple;margin-top:4px">${date}</p >
                                        </li > `
                }).join('')
            } else {
                if (!res) return closeModal('#smsList')
                list.innerHTML = ` <li> <h2 style="padding: 30px;">Ê≤°ÊúâÁü≠‰ø°</h2></li >`
                createToast('Ê≤°ÊúâÁü≠‰ø°', 'red')
            }
        }
        var getStatus = () => {
            fetch('https://api.kanokano.cn/status/')
                .then((res) => res.json())
                .then((data) => {
                    let listEl = document.querySelector('#deviceList')
                    if (data.status !== 0) {
                        listEl.innerHTML = `<h3 style="color:#333;margin:0">Êï∞ÊçÆËé∑ÂèñÂ§±Ë¥•</h3>`
                        return
                    }

                    if (!data.records || !data.records.length) {
                        listEl.innerHTML = `<h3 style="color:#333;margin:0">Ê≤°ÊúâÊï∞ÊçÆÂì¶~</h3>`
                        return
                    }
                    let html = ``
                    data.records.forEach((item) => {
                        let detail = item.detail
                        html += `<li style="padding-top: 15px;">`
                        detail ? (html += `<p>
                            <strong><span class="${item.isOnline ? 'green' : 'red'}">${item.isOnline ? '[Âú®Á∫ø]&nbsp;' : '[Á¶ªÁ∫ø]&nbsp;'}</span>${item.name}</strong>
                            ${((detail.isCharging !== undefined) && (detail.isCharging !== null)) ? `<strong  class="${detail.isCharging ? 'green' : 'red'}">${detail.isCharging == true ? detail.chargingText ? detail.chargingText : 'ÂÖÖÁîµ‰∏≠‚ö°' : 'Êú™Âú®ÂÖÖÁîµ'} ${detail.battery ? 'ÁîµÈáèÔºö' + detail.battery + '% üîã' : ''}${detail.batteryCurrent ? ' ÁîµÊ±†ÁîµÊµÅÔºö' + detail.batteryCurrent + 'mA' : ''}${detail.batteryTemperature ? ' ÁîµÊ±†Ê∏©Â∫¶Ôºö' + detail.batteryTemperature + '‚ÑÉ' : ''}</strong>` : ''}
                            ${((detail.isScreenOn !== undefined) && (detail.isScreenOn !== null)) ? `<strong  class="${detail.isScreenOn ? 'blue' : 'red'}">${detail.isScreenOn ? '‰∫ÆÂ±è‰∏≠' : 'ÂÖ≥Â±è‰ºëÊÅØ‰∏≠'}</strong>` : ''}
                            ${((detail.wifiStatus !== undefined) && (detail.wifiStatus !== null)) ? `<strong  class="${detail.wifiStatus == 'connected' ? 'green' : 'red'}">${detail.wifiStatus == 'connected' ? 'Â∑≤ËøûÊé•WiFi' : 'Êú™ËøûÊé•WiFi'}</strong>` : ''}
                            ${detail.cellularStatus ? `<strong  class="green">ËúÇÁ™ùÁä∂ÊÄÅÔºö${detail.cellularStatus}</strong>` : ''}

                            ${detail.F50_data ? (`
                                ${detail.F50_data.network_type ? `<strong  class="green">ËúÇÁ™ùÁä∂ÊÄÅÔºö${detail.F50_data.network_provider} ${detail.F50_data.network_type}</strong>` : ''}
                                ${detail.F50_data.wifi_access_sta_num ? `<strong  class="blue">ËÆæÂ§áÊï∞Ôºö${detail.F50_data.wifi_access_sta_num}</strong>` : ''}
                                ${detail.F50_data.rssi ? `<strong  class="green">ËúÇÁ™ù‰ø°Âè∑Âº∫Â∫¶Ôºö${kano_getSignalEmoji(detail.F50_data.rssi)}</strong>` : ''}
                                ${detail.F50_data.realtime_time ? `<strong  class="blue">ËøûÊé•Êó∂ÈïøÔºö${kano_formatTime(Number(detail.F50_data.realtime_time))}${detail.F50_data.monthly_time ? '&nbsp;<span style="color:white">/</span>&nbsp;ÊÄªÊó∂Èïø(Êúà): ' + kano_formatTime(Number(detail.F50_data.monthly_time)) : ''}</strong>` : ''}
                                ${detail.F50_data.realtime_tx_thrpt != undefined && detail.F50_data.realtime_rx_thrpt != undefined ? `<strong  class="blue">ÂΩìÂâçÁΩëÈÄü: ‚¨áÔ∏è ${formatBytes(Number((detail.F50_data.realtime_rx_thrpt)))}/S ‚¨ÜÔ∏è ${formatBytes(Number((detail.F50_data.realtime_tx_thrpt)))}/S</strong>` : ''}
                                ${(detail.F50_data.monthly_tx_bytes && detail.F50_data.monthly_rx_bytes) ? `<strong  class="blue">Â∑≤Áî®ÊµÅÈáèÔºö<span class="red">${Number((detail.F50_data.monthly_tx_bytes + detail.F50_data.monthly_rx_bytes) / 1024 / 1024 / 1024).toFixed(2)} GB</span>${detail.F50_data.data_volume_limit_size ? '&nbsp;<span style="color:white">/</span>&nbsp;ÊÄªÊµÅÈáèÔºö' + detail.F50_data.data_volume_limit_size.split('_')[0] + ' GB' : ''}</strong>` : ''}
                                ${detail.F50_data.wifi_access_sta_num ? `<strong  class="blue" id="smsBtn" style="border:1px solid skyblue">Áü≠‰ø°Êî∂Âèë</strong>` : ''}
                            `) : ''}
                        </p>`) : '';
                        detail.currentPageTabTitle && (html += `<p><strong class="blue">ÂΩìÂâçÊ≠£Âú®ÁúãÔºö${detail.currentPageTabTitle}</strong></p>`)
                        html += `<p style="color:#999;justify-content: end;margin:0 10px 0 0;padding:0;font-size:12px">Êõ¥Êñ∞Êó∂Èó¥Ôºö${(new Date(item.lastUpdated)).toLocaleString("zh-CN", {
                            month: "2-digit",
                            day: "2-digit",
                            hour: "2-digit",
                            minute: "2-digit",
                            second: "2-digit",
                            hour12: false // 24Â∞èÊó∂Âà∂
                        })}</p > `
                        html += `</li >`
                    })
                    listEl.innerHTML = html
                    var smsBtn = document.querySelector('#smsBtn')
                    smsBtn && (smsBtn.onclick = async () => {
                        if (!localStorage.getItem('kano_sms_token')) {
                            showModal('#tokenModal')
                        } else {
                            handleSmsRender()
                        }
                    })
                });
        }
        getStatus()
        requestInterval(() => {
            getStatus()
        }, 2000)
    </script>
</body>

</html>